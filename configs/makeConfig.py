from glob import glob
import json

def extract_sample_year(sample):
    if "UL16" in sample and "APV" in sample:
        return "2016preVFP"
    elif "UL16" in sample and not "APV" in sample:
        return "2016postVFP"
    elif "UL17" in sample:
        return "2017"
    elif "UL18" in sample:
        return "2018"

def get_xsec_weight(InputYear):
    weight_xsec = 0
    if(InputYear == "DYJetsToLL_M-10to50,2016APV"):
        weight_xsec = 15.6291
    if(InputYear == "DYJetsToLL_M-10to50,2016"):
        weight_xsec = 15.5099
    if(InputYear == "DYJetsToLL_M-10to50,2017"):
        weight_xsec = 12.5272
    if(InputYear == "DYJetsToLL_M-10to50,2018"):
        weight_xsec = 13.0565
    if(InputYear == "DYJetsToLL_M-50,2016APV"):
        weight_xsec = 1.27124
    if(InputYear == "DYJetsToLL_M-50,2016"):
        weight_xsec = 1.26368
    if(InputYear == "DYJetsToLL_M-50,2017"):
        weight_xsec = 2.5023
    if(InputYear == "DYJetsToLL_M-50,2018"):
        weight_xsec = 3.84504
    if(InputYear == "EWKWMinus2Jets_WToLNu_M-50,2016APV"):
        weight_xsec = 0.280122
    if(InputYear == "EWKWMinus2Jets_WToLNu_M-50,2016"):
        weight_xsec = 0.246272
    if(InputYear == "EWKWMinus2Jets_WToLNu_M-50,2017"):
        weight_xsec = 0.328606
    if(InputYear == "EWKWMinus2Jets_WToLNu_M-50,2018"):
        weight_xsec = 0.429989
    if(InputYear == "EWKWPlus2Jets_WToLNu_M-50,2016APV"):
        weight_xsec = 0.35136
    if(InputYear == "EWKWPlus2Jets_WToLNu_M-50,2016"):
        weight_xsec = 0.325203
    if(InputYear == "EWKWPlus2Jets_WToLNu_M-50,2017"):
        weight_xsec = 0.454335
    if(InputYear == "EWKWPlus2Jets_WToLNu_M-50,2018"):
        weight_xsec = 0.523173
    if(InputYear == "EWKWminus2Jets_WToQQ_dipoleRecoilOn,2016APV"):
        weight_xsec = 0.041664
    if(InputYear == "EWKWminus2Jets_WToQQ_dipoleRecoilOn,2016"):
        weight_xsec = 0.035886
    if(InputYear == "EWKWminus2Jets_WToQQ_dipoleRecoilOn,2017"):
        weight_xsec = 0.0562756
    if(InputYear == "EWKWminus2Jets_WToQQ_dipoleRecoilOn,2018"):
        weight_xsec = 0.0659761
    if(InputYear == "EWKWplus2Jets_WToQQ_dipoleRecoilOn,2016APV"):
        weight_xsec = 0.042136
    if(InputYear == "EWKWplus2Jets_WToQQ_dipoleRecoilOn,2016"):
        weight_xsec = 0.035886
    if(InputYear == "EWKWplus2Jets_WToQQ_dipoleRecoilOn,2017"):
        weight_xsec = 0.0554309
    if(InputYear == "EWKWplus2Jets_WToQQ_dipoleRecoilOn,2018"):
        weight_xsec = 0.0637573
    if(InputYear == "EWKZ2Jets_ZToLL_M-50,2016APV"):
        weight_xsec = 0.242829
    if(InputYear == "EWKZ2Jets_ZToLL_M-50,2016"):
        weight_xsec = 0.230813
    if(InputYear == "EWKZ2Jets_ZToLL_M-50,2017"):
        weight_xsec = 0.446132
    if(InputYear == "EWKZ2Jets_ZToLL_M-50,2018"):
        weight_xsec = 0.371334
    if(InputYear == "EWKZ2Jets_ZToNuNu_M-50,2016APV"):
        weight_xsec = 0.144313
    if(InputYear == "EWKZ2Jets_ZToNuNu_M-50,2016"):
        weight_xsec = 0.120135
    if(InputYear == "EWKZ2Jets_ZToNuNu_M-50,2017"):
        weight_xsec = 0.149594
    if(InputYear == "EWKZ2Jets_ZToNuNu_M-50,2018"):
        weight_xsec = 0.215555
    if(InputYear == "EWKZ2Jets_ZToQQ_dipoleRecoilOn,2016APV"):
        weight_xsec = 0.0418314
    if(InputYear == "EWKZ2Jets_ZToQQ_dipoleRecoilOn,2016"):
        weight_xsec = 0.036396
    if(InputYear == "EWKZ2Jets_ZToQQ_dipoleRecoilOn,2017"):
        weight_xsec = 0.0553893
    if(InputYear == "EWKZ2Jets_ZToQQ_dipoleRecoilOn,2018"):
        weight_xsec = 0.0637956
    if(InputYear == "TTTo2L2Nu,2016APV"):
        weight_xsec = 0.000637235
    if(InputYear == "TTTo2L2Nu,2016"):
        weight_xsec = 0.000472642
    if(InputYear == "TTTo2L2Nu,2017"):
        weight_xsec = 0.000476439
    if(InputYear == "TTTo2L2Nu,2018"):
        weight_xsec = 0.000508988
    if(InputYear == "TTToHadronic,2016APV"):
        weight_xsec = 0.000241649
    if(InputYear == "TTToHadronic,2016"):
        weight_xsec = 0.000189043
    if(InputYear == "TTToHadronic,2017"):
        weight_xsec = 0.000214604
    if(InputYear == "TTToHadronic,2018"):
        weight_xsec = 0.000216954
    if(InputYear == "TTToSemiLeptonic,2016APV"):
        weight_xsec = 0.000179307
    if(InputYear == "TTToSemiLeptonic,2016"):
        weight_xsec = 0.000141024
    if(InputYear == "TTToSemiLeptonic,2017"):
        weight_xsec = 0.000145705
    if(InputYear == "TTToSemiLeptonic,2018"):
        weight_xsec = 0.00015504
    if(InputYear == "TTWJetsToLNu,2016APV"):
        weight_xsec = 0.0041804
    if(InputYear == "TTWJetsToLNu,2016"):
        weight_xsec = 0.00308519
    if(InputYear == "TTWJetsToLNu,2017"):
        weight_xsec = 0.00354575
    if(InputYear == "TTWJetsToLNu,2018"):
        weight_xsec = 0.00348217
    if(InputYear == "TTWW,2016APV"):
        weight_xsec = 0.000807482
    if(InputYear == "TTWW,2016"):
        weight_xsec = 0.000625615
    if(InputYear == "TTWW,2017"):
        weight_xsec = 0.000684217
    if(InputYear == "TTWW,2018"):
        weight_xsec = 0.000727278
    if(InputYear == "TTWZ,2016APV"):
        weight_xsec = 0.000541541
    if(InputYear == "TTWZ,2016"):
        weight_xsec = 0.000410629
    if(InputYear == "TTWZ,2017"):
        weight_xsec = 0.000460853
    if(InputYear == "TTWZ,2018"):
        weight_xsec = 0.000465612
    if(InputYear == "TTZToLLNuNu_M-10,2016APV"):
        weight_xsec = 0.00348729
    if(InputYear == "TTZToLLNuNu_M-10,2016"):
        weight_xsec = 0.00289547
    if(InputYear == "TTZToLLNuNu_M-10,2017"):
        weight_xsec = 0.0030665
    if(InputYear == "TTZToLLNuNu_M-10,2018"):
        weight_xsec = 0.00315665
    if(InputYear == "TTbb_4f_TTTo2L2Nu,2016APV"):
        weight_xsec = 0.00012262
    if(InputYear == "TTbb_4f_TTTo2L2Nu,2016"):
        weight_xsec = 9.32674e-05
    if(InputYear == "TTbb_4f_TTTo2L2Nu,2017"):
        weight_xsec = 0.000104273
    if(InputYear == "TTbb_4f_TTTo2L2Nu,2018"):
        weight_xsec = 0.000108612
    if(InputYear == "TTbb_4f_TTToSemiLeptonic,2016APV"):
        weight_xsec = 0.000211376
    if(InputYear == "TTbb_4f_TTToSemiLeptonic,2016"):
        weight_xsec = 0.000168898
    if(InputYear == "TTbb_4f_TTToSemiLeptonic,2017"):
        weight_xsec = 0.000167415
    if(InputYear == "TTbb_4f_TTToSemiLeptonic,2018"):
        weight_xsec = 0.000158203
    if(InputYear == "VBFWH_HToBB_WToLNu_M-125_dipoleRecoilOn,2016APV"):
        weight_xsec = 0.000193669
    if(InputYear == "VBFWH_HToBB_WToLNu_M-125_dipoleRecoilOn,2016"):
        weight_xsec = 0.000194278
    if(InputYear == "VBFWH_HToBB_WToLNu_M-125_dipoleRecoilOn,2017"):
        weight_xsec = 0.000221399
    if(InputYear == "VBFWH_HToBB_WToLNu_M-125_dipoleRecoilOn,2018"):
        weight_xsec = 0.000318081
    if(InputYear == "VHToNonbb_M125,2016APV"):
        weight_xsec = 0.01682
    if(InputYear == "VHToNonbb_M125,2016"):
        weight_xsec = 0.0193468
    if(InputYear == "VHToNonbb_M125,2017"):
        weight_xsec = 0.018091
    if(InputYear == "VHToNonbb_M125,2018"):
        weight_xsec = 0.0187589
    if(InputYear == "WJetsToLNu_HT-100To200,2016APV"):
        weight_xsec = 1.1908
    if(InputYear == "WJetsToLNu_HT-100To200,2016"):
        weight_xsec = 1.10886
    if(InputYear == "WJetsToLNu_HT-100To200,2017"):
        weight_xsec = 1.16881
    if(InputYear == "WJetsToLNu_HT-100To200,2018"):
        weight_xsec = 1.55112
    if(InputYear == "WJetsToLNu_HT-1200To2500,2016APV"):
        weight_xsec = 0.0109394
    if(InputYear == "WJetsToLNu_HT-1200To2500,2016"):
        weight_xsec = 0.00929078
    if(InputYear == "WJetsToLNu_HT-1200To2500,2017"):
        weight_xsec = 0.0103383
    if(InputYear == "WJetsToLNu_HT-1200To2500,2018"):
        weight_xsec = 0.0108959
    if(InputYear == "WJetsToLNu_HT-200To400,2016APV"):
        weight_xsec = 0.380737
    if(InputYear == "WJetsToLNu_HT-200To400,2016"):
        weight_xsec = 0.380484
    if(InputYear == "WJetsToLNu_HT-200To400,2017"):
        weight_xsec = 0.344194
    if(InputYear == "WJetsToLNu_HT-200To400,2018"):
        weight_xsec = 0.360594
    if(InputYear == "WJetsToLNu_HT-2500ToInf,2016APV"):
        weight_xsec = 0.000581703
    if(InputYear == "WJetsToLNu_HT-2500ToInf,2016"):
        weight_xsec = 0.000512308
    if(InputYear == "WJetsToLNu_HT-2500ToInf,2017"):
        weight_xsec = 0.000903933
    if(InputYear == "WJetsToLNu_HT-2500ToInf,2018"):
        weight_xsec = 0.000726316
    if(InputYear == "WJetsToLNu_HT-400To600,2016APV"):
        weight_xsec = 0.374249
    if(InputYear == "WJetsToLNu_HT-400To600,2016"):
        weight_xsec = 0.36104
    if(InputYear == "WJetsToLNu_HT-400To600,2017"):
        weight_xsec = 0.353684
    if(InputYear == "WJetsToLNu_HT-400To600,2018"):
        weight_xsec = 0.378267
    if(InputYear == "WJetsToLNu_HT-600To800,2016APV"):
        weight_xsec = 0.0945842
    if(InputYear == "WJetsToLNu_HT-600To800,2016"):
        weight_xsec = 0.0821543
    if(InputYear == "WJetsToLNu_HT-600To800,2017"):
        weight_xsec = 0.0834916
    if(InputYear == "WJetsToLNu_HT-600To800,2018"):
        weight_xsec = 0.0883237
    if(InputYear == "WJetsToLNu_HT-70To100,2016APV"):
        weight_xsec = 1.51115
    if(InputYear == "WJetsToLNu_HT-70To100,2016"):
        weight_xsec = 1.11022
    if(InputYear == "WJetsToLNu_HT-70To100,2017"):
        weight_xsec = 1.22953
    if(InputYear == "WJetsToLNu_HT-70To100,2018"):
        weight_xsec = 1.19107
    if(InputYear == "WJetsToLNu_HT-800To1200,2016APV"):
        weight_xsec = 0.0404996
    if(InputYear == "WJetsToLNu_HT-800To1200,2016"):
        weight_xsec = 0.0389598
    if(InputYear == "WJetsToLNu_HT-800To1200,2017"):
        weight_xsec = 0.0409902
    if(InputYear == "WJetsToLNu_HT-800To1200,2018"):
        weight_xsec = 0.0418681
    if(InputYear == "WWTo2L2Nu,2016APV"):
        weight_xsec = 0.00710518
    if(InputYear == "WWTo2L2Nu,2016"):
        weight_xsec = 0.00636799
    if(InputYear == "WWTo2L2Nu,2017"):
        weight_xsec = 0.00642716
    if(InputYear == "WWTo2L2Nu,2018"):
        weight_xsec = 0.00656189
    if(InputYear == "WWTolnulnu,2016APV"):
        weight_xsec = 10.0838
    if(InputYear == "WWTolnulnu,2016"):
        weight_xsec = 8.68625
    if(InputYear == "WWTolnulnu,2017"):
        weight_xsec = 33.0717
    if(InputYear == "WWTolnulnu,2018"):
        weight_xsec = 45.852
    if(InputYear == "WWW_4F,2016APV"):
        weight_xsec = 0.00363464
    if(InputYear == "WWW_4F,2016"):
        weight_xsec = 0.00390494
    if(InputYear == "WWW_4F,2017"):
        weight_xsec = 0.00407266
    if(InputYear == "WWW_4F,2018"):
        weight_xsec = 0.00583093
    if(InputYear == "WWZ_4F,2016APV"):
        weight_xsec = 0.00372044
    if(InputYear == "WWZ_4F,2016"):
        weight_xsec = 0.00353674
    if(InputYear == "WWZ_4F,2017"):
        weight_xsec = 0.225642
    if(InputYear == "WWZ_4F,2018"):
        weight_xsec = 0.0057934
    if(InputYear == "WZJJ_EWK_InclusivePolarization,2016APV"):
        weight_xsec = 0.0107987
    if(InputYear == "WZJJ_EWK_InclusivePolarization,2016"):
        weight_xsec = 0.0100226
    if(InputYear == "WZJJ_EWK_InclusivePolarization,2017"):
        weight_xsec = 0.0226449
    if(InputYear == "WZJJ_EWK_InclusivePolarization,2018"):
        weight_xsec = 0.0347331
    if(InputYear == "WZTo3LNu,2016APV"):
        weight_xsec = 0.00106073
    if(InputYear == "WZTo3LNu,2016"):
        weight_xsec = 0.000842635
    if(InputYear == "WZTo3LNu,2017"):
        weight_xsec = 0.00210097
    if(InputYear == "WZTo3LNu,2018"):
        weight_xsec = 0.00318055
    if(InputYear == "WZZ,2016APV"):
        weight_xsec = 0.00352214
    if(InputYear == "WZZ,2016"):
        weight_xsec = 0.00359348
    if(InputYear == "WZZ,2017"):
        weight_xsec = 0.00408461
    if(InputYear == "WZZ,2018"):
        weight_xsec = 0.00581363
    if(InputYear == "WminusH_HToBB_WToLNu_M-125,2016APV"):
        weight_xsec = 0.00209656
    if(InputYear == "WminusH_HToBB_WToLNu_M-125,2016"):
        weight_xsec = 0.00207706
    if(InputYear == "WminusH_HToBB_WToLNu_M-125,2017"):
        weight_xsec = 0.00242768
    if(InputYear == "WminusH_HToBB_WToLNu_M-125,2018"):
        weight_xsec = 0.00339087
    if(InputYear == "WplusH_HToBB_WToLNu_M-125,2016APV"):
        weight_xsec = 0.00222174
    if(InputYear == "WplusH_HToBB_WToLNu_M-125,2016"):
        weight_xsec = 0.00226259
    if(InputYear == "WplusH_HToBB_WToLNu_M-125,2017"):
        weight_xsec = 0.00255594
    if(InputYear == "WplusH_HToBB_WToLNu_M-125,2018"):
        weight_xsec = 0.0036796
    if(InputYear == "ZH_HToBB_ZToLL_M-125,2016APV"):
        weight_xsec = 0.00241384
    if(InputYear == "ZH_HToBB_ZToLL_M-125,2016"):
        weight_xsec = 0.00250719
    if(InputYear == "ZH_HToBB_ZToLL_M-125,2017"):
        weight_xsec = 0.00296544
    if(InputYear == "ZH_HToBB_ZToLL_M-125,2018"):
        weight_xsec = 0.00402611
    if(InputYear == "ZZJJTo4L,2016APV"):
        weight_xsec = 8.63572e-05
    if(InputYear == "ZZJJTo4L,2016"):
        weight_xsec = 7.46111e-05
    if(InputYear == "ZZJJTo4L,2017"):
        weight_xsec = 9.1802e-05
    if(InputYear == "ZZJJTo4L,2018"):
        weight_xsec = 0.000131937
    if(InputYear == "ZZTo2L2Nu,2016APV"):
        weight_xsec = 0.000670512
    if(InputYear == "ZZTo2L2Nu,2016"):
        weight_xsec = 0.000611274
    if(InputYear == "ZZTo2L2Nu,2017"):
        weight_xsec = 0.000588983
    if(InputYear == "ZZTo2L2Nu,2018"):
        weight_xsec = 0.000607852
    if(InputYear == "ZZTo4L_M-1toInf,2016APV"):
        weight_xsec = 9.02688e-05
    if(InputYear == "ZZTo4L_M-1toInf,2016"):
        weight_xsec = 8.40114e-05
    if(InputYear == "ZZTo4L_M-1toInf,2017"):
        weight_xsec = 9.03515e-05
    if(InputYear == "ZZTo4L_M-1toInf,2018"):
        weight_xsec = 8.44991e-05
    if(InputYear == "ZZZ,2016APV"):
        weight_xsec = 0.00348442
    if(InputYear == "ZZZ,2016"):
        weight_xsec = 0.00351073
    if(InputYear == "ZZZ,2017"):
        weight_xsec = 0.00412841
    if(InputYear == "ZZZ,2018"):
        weight_xsec = 0.0057154
    if(InputYear == "ggZH_HToBB_ZToLL_M-125,2016APV"):
        weight_xsec = 0.0032155
    if(InputYear == "ggZH_HToBB_ZToLL_M-125,2016"):
        weight_xsec = 0.00305625
    if(InputYear == "ggZH_HToBB_ZToLL_M-125,2017"):
        weight_xsec = 0.00353689
    if(InputYear == "ggZH_HToBB_ZToLL_M-125,2018"):
        weight_xsec = 0.00485784
    if(InputYear == "ttHToNonbb_M125,2016APV"):
        weight_xsec = 0.00423661
    if(InputYear == "ttHToNonbb_M125,2016"):
        weight_xsec = 0.00321883
    if(InputYear == "ttHToNonbb_M125,2017"):
        weight_xsec = 0.00351483
    if(InputYear == "ttHToNonbb_M125,2018"):
        weight_xsec = 0.00349592
    if(InputYear == "ttHTobb_M125,2016APV"):
        weight_xsec = 0.00107828
    if(InputYear == "ttHTobb_M125,2016"):
        weight_xsec = 0.000869231
    if(InputYear == "ttHTobb_M125,2017"):
        weight_xsec = 0.00135507
    if(InputYear == "ttHTobb_M125,2018"):
        weight_xsec = 0.00157649
    # sig
    if(InputYear == "VBSWWH_OS,2016"):
        weight_xsec = 0.000475387
    if(InputYear == "VBSWWH_OS,2016APV"):
        weight_xsec = 0.000552026
    if(InputYear == "VBSWWH_OS,2017"):
        weight_xsec = 0.00117444
    if(InputYear == "VBSWWH_OS,2018"):
        weight_xsec = 0.00168832
    if(InputYear == "VBSWWH_SS,2016"):
        weight_xsec = 0.000256521
    if(InputYear == "VBSWWH_SS,2016APV"):
        weight_xsec = 0.000297875
    if(InputYear == "VBSWWH_SS,2017"):
        weight_xsec = 0.000633733
    if(InputYear == "VBSWWH_SS,2018"):
        weight_xsec = 0.000911022
    if(InputYear == "VBSWZH,2016"):
        weight_xsec = 0.00027518
    if(InputYear == "VBSWZH,2016APV"):
        weight_xsec = 0.000319542
    if(InputYear == "VBSWZH,2017"):
        weight_xsec = 0.00067983
    if(InputYear == "VBSWZH,2018"):
        weight_xsec = 0.000977289
    if(InputYear == "VBSZZH,2016"):
        weight_xsec = 0.000190289
    if(InputYear == "VBSZZH,2016APV"):
        weight_xsec = 0.000220966
    if(InputYear == "VBSZZH,2017"):
        weight_xsec = 0.000470108
    if(InputYear == "VBSZZH,2018"):
        weight_xsec = 0.000675804
    return weight_xsec

def make_config():
    config = {"samples": {}}
    sample_list = sorted(glob("/ceph/cms/store/user/jguiang/VBSVHSkim/bkg_1lep_4ak4_or_1ak8_2ak4_v1/*"))
    print(len(sample_list))
    for sample in sample_list:
        sample_name = sample.split("/ceph/cms/store/user/jguiang/VBSVHSkim/bkg_1lep_4ak4_or_1ak8_2ak4_v1/")[1].split(",")[0].split("_Tune")[0]
        sample_year = extract_sample_year(sample)
        xsec = get_xsec_weight(sample_name + "," + sample_year)
        config["samples"].update(
            {
                sample_name + "_" + sample_year: {
                    "trees": ["Events"],
                    "files": [sample + "/merged*.root"],
                    "metadata": {
                        "sample_category": "bkg",
                        "year" : sample_year,
                        "xsec": xsec
                    }
                }
            }
        )
    return config

if __name__ == "__main__":
    config = make_config()
    json.dump(config, open("config.json", "w"), indent=4)